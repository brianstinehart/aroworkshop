I"¯	
<h4 id="1-create-the-horizontal-pod-autoscaler">1. Create the Horizontal Pod Autoscaler</h4>

<p>Run the following command to create the autoscaler. This will create an HPA that maintains between 1 and 10 replicas of the Pods controlled by the <em>ostoy-microservice</em> DeploymentConfig created. Roughly speaking, the HPA will increase and decrease the number of replicas (via the deployment) to maintain an average CPU utilization across all Pods of 80% (since each pod requests 50 millicores, this means average CPU usage of 40 millicores)</p>

<p><code class="language-plaintext highlighter-rouge">oc autoscale deployment/ostoy-microservice --cpu-percent=80 --min=1 --max=10</code></p>

<h4 id="2-view-the-current-number-of-pods">2. View the current number of pods</h4>

<p>In the OSToy app in the left menu click on ‚ÄúAutoscaling‚Äù to access this portion of the workshop.</p>

<p><img src="media/managedlab/32-hpa-menu.png" alt="HPA Menu" /></p>

<p>As was in the networking section you will see the total number of pods available for the microservice by counting the number of colored boxes.  In this case we have only one.  This can be verified through the web UI or from the CLI.</p>

<p>You can use the following command to see the running microservice pods only:
<code class="language-plaintext highlighter-rouge">oc get pods --field-selector=status.phase=Running | grep microservice</code></p>

<p><img src="media/managedlab/33-hpa-mainpage.png" alt="HPA Main" /></p>

<h4 id="3-increase-the-load">3. Increase the load</h4>

<p>Now that we know that we only have one pod let‚Äôs increase the workload that the pod needs to perform. Click the link in the center of the card that says ‚Äúincrease the load‚Äù.  <strong>Please click only <em>ONCE</em>!</strong></p>

<p>This will generate some CPU intensive calculations.  (If you are curious about what it is doing you can click <a href="https://github.com/openshift-cs/ostoy/blob/master/microservice/app.js#L32">here</a>).</p>

<blockquote>
  <p><strong>Note:</strong> The page may become slightly unresponsive.  This is normal; so be patient while the new pods spin up.</p>
</blockquote>

<h4 id="4-see-the-pods-scale-up">4. See the pods scale up</h4>

<p>After about a minute the new pods will show up on the page (represented by the colored rectangles). Confirm that the pods did indeed scale up through the OpenShift Web Console or the CLI (you can use the command above).</p>

<blockquote>
  <p><strong>Note:</strong> The page may still lag a bit which is normal.</p>
</blockquote>

:ET